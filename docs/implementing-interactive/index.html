<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>Implementing Interactive - LARA Interactive API</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Implementing Interactive";
    var mkdocs_page_input_path = "implementing-interactive.md";
    var mkdocs_page_url = "/implementing-interactive/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> LARA Interactive API</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">LARA Interactive API</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">Implementing Interactive</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#implementing-interactive">Implementing Interactive</a></li>
                
                    <li><a class="toctree-l4" href="#iframe-phone-setup">iframe-phone setup</a></li>
                
                    <li><a class="toctree-l4" href="#handling-the-initinteractive-message">Handling the initInteractive message</a></li>
                
                    <li><a class="toctree-l4" href="#interactive-customization">Interactive customization</a></li>
                
                    <li><a class="toctree-l4" href="#saving-student-progress">Saving student progress</a></li>
                
                    <li><a class="toctree-l4" href="#custom-learner-url">Custom learner URL</a></li>
                
                    <li><a class="toctree-l4" href="#global-interactive-state">Global interactive state</a></li>
                
                    <li><a class="toctree-l4" href="#logging">Logging</a></li>
                
                    <li><a class="toctree-l4" href="#auth-info">Auth info</a></li>
                
                    <li><a class="toctree-l4" href="#getextendedsupport">getExtendedSupport</a></li>
                
                    <li><a class="toctree-l4" href="#linked-interactives">Linked interactives</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../shutterbug/">Shutterbug API</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../using-iframe-phone/">Using iFramePhone</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../safari-cookies-redirects/">Safari / IE, cookies and iframe redirects</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../about-mkdocs/">About the documentation generator</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">LARA Interactive API</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Implementing Interactive</li>
    <li class="wy-breadcrumbs-aside">
      
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="implementing-interactive">Implementing Interactive</h1>
<p>LARA embeds interactives using iframe and provides LARA Interactive API. This API can be used e.g. to customize interactive,
save state authored by teachers or save student progress. The whole communication between LARA and Interactive
happens through <a href="https://github.com/concord-consortium/iframe-phone">iFramePhone</a> which is a simple wrapper around 
<code>postMessage</code> API. Interactive which wants to use LARA Interactive API needs to use this library. Check its 
readme to see how to include it in your project (npm, RequireJS or via script tag). Once <code>iframePhone</code> library is 
available, Interactive needs to setup communication:</p>
<h3 id="iframe-phone-setup">iframe-phone setup</h3>
<pre><code class="javascript">var phone = iframePhone.getIFrameEndpoint();
phone.addListener('initInteractive', function (data) {
  // handle initInteractive call
});
phone.addListener('otherMessageType', function (data) {
  // handle otherMessageType call
});
// more handlers here 
// (...)
// IMPORTANT: Initialize connection after all message listeners are added!
phone.initialize();
// Informat LARA about supported features. Some of them require that (e.g. state authoring, student progress saving):
phone.post('supportedFeatures', {
  apiVersion: 1, 
  features: {
    someFeature: true 
    otherFeature: true
  }
});
</code></pre>

<h3 id="handling-the-initinteractive-message">Handling the <code>initInteractive</code> message</h3>
<p>This is one of the most important messages sent by LARA. It provides most of the information stored by LARA.
It tells the interactive what is the current API version, mode (<code>runtime</code> or <code>authoring</code>), <code>authoredState</code> (state defined by teacher), 
<code>interactiveState</code> (state based on student work) and so on. Interactive should add <code>initInteractive</code> handler that
reads values stored in <code>data</code> Object / hash:</p>
<pre><code class="javascript">phone.addListener('initInteractive', function (data) {
  // process data object, e.g.:
  initializeMode(data.mode);
  loadAuthoredState(data.authoredState);
  loadStudentWork(data.interactiveState);
});  
</code></pre>

<p><code>data</code> consists of:</p>
<ul>
<li>error - <code>null</code> if everything is okay, error message otherwise (e.g. data fetching might fail).</li>
<li>mode - <code>"authoring"</code> or <code>"runtime"</code>. Interactive can be displayed in one of those two modes, but it's up to interactive whether
 it supports authoring mode. Runtime is basic mode which is presented to students. Authoring mode can be used
 by authors to customize interactive.</li>
<li><strong>[optional]</strong> authoredState - JSON that has been saved by interactive earlier in authoring mode using <code>authoredState</code> message (described
 below in other section). If it's not defined, it would be falsy value (null or empty string).</li>
<li><strong>[optional]</strong> interactiveState - JSON that has been saved by interactive earlier in runtime mode using <code>interactiveState</code> message (described
 below in other section). Provided only in runtime mode. If it's not defined, it would be falsy value (null or empty string).</li>
<li><strong>[optional]</strong> globalInteractiveState - JSON that has been saved by interactive earlier in runtime mode using <code>globalInteractiveState</code> message (described
 below in other section). Provided only in runtime mode. If it's not defined, it would be falsy value (null or empty string).</li>
<li><strong>[optional]</strong> hasLinkedInteractive - TODO</li>
<li><strong>[optional]</strong> linkedState - TODO</li>
<li><strong>[optional]</strong> interactiveStateUrl - TODO</li>
<li><strong>[optional]</strong> collaboratorUrls - TODO</li>
</ul>
<h3 id="interactive-customization">Interactive customization</h3>
<p>If interactive wants to support customization, it should inform LARA about it using <code>supportedFeatures</code> message:</p>
<pre><code class="javascript">phone.post('supportedFeatures', {
  apiVersion: 1, 
  features: {
    authoredState: true 
    // + other supported features
  }
});  
</code></pre>

<p><code>initInteractive</code> message provides <code>mode</code> property. Interactive can display authoring interface when mode value is equal
to <code>"authoring"</code>. Every customization made by author should be sent back to LARA using <code>authoredState</code> message:</p>
<pre><code class="javascript">phone.post('authoredState', authoredState);  
</code></pre>

<p>There are no requirements regarding <code>authoredState</code> expect from the fact that it should be a JSON.
Next time the interactive is loaded either in authoring or runtime mode, <code>initInteractive</code> will provide this state to the interactive 
in <code>authoredState</code> property.
Note that it's recommended that <code>authoredState</code> should be sent to LARA immediately after every change. LARA provides
its own "Save" button that would actually save this state to the DB and "Reset" which would set it back to null.</p>
<h3 id="saving-student-progress">Saving student progress</h3>
<p>If interactive wants to support student progress saving, it should inform LARA about it using <code>supportedFeatures</code> message:</p>
<pre><code class="javascript">phone.post('supportedFeatures', {
  apiVersion: 1, 
  features: {
    interactiveState: true 
    // + other supported features
  }
});  
</code></pre>

<p><code>initInteractive</code> provides <code>mode</code> property. <code>"runtime"</code> mode means that Interactive is viewed by student. Interactive
 can save student progress using <code>interactiveState</code> message:</p>
<pre><code class="javascript">phone.post('interactiveState', interactiveState);  
</code></pre>

<p>There are no requirements regarding <code>interactiveState</code> expect from the fact that it should be a JSON.
Next time the interactive is loaded either in runtime mode, <code>initInteractive</code> will provide this state to the interactive
in <code>interactiveState</code> property.</p>
<h3 id="custom-learner-url">Custom learner URL</h3>
<p>This feature is related to student progress saving. Interactive can provide versioned URL to make sure that given
data format is always supported (otherwise, e.g. interactive can be updated, but LARA would still try to load old data format).</p>
<pre><code class="javascript">phone.post('setLearnerUrl', 'https://my.example.interactive/version/1');  
</code></pre>

<h3 id="global-interactive-state">Global interactive state</h3>
<p>A few interactives can share one, global state within a single LARA activity. E.g. you can let students work on the 
same model on different pages of the activity. Interactive can set global state using <code>interactiveStateGlobal</code> message:</p>
<pre><code class="javascript">phone.post('interactiveStateGlobal', globalState);
</code></pre>

<p>Once this message is received, the server immediately posts <code>loadInteractiveGlobal</code> to all interactives on the same page 
(except from the sender of the original save message). So, interactives can listen to this message:</p>
<pre><code class="javascript">phone.addListener('loadInteraciveGlobal', function (globalState) {
  // Process global state, e.g.:
  loadState(globalState);
});  
</code></pre>

<p>Also, if global state is available for the activity (so, one of the interactives has sent <code>interactiveStateGlobal</code> message before),
it will be provided in <code>initInteractive</code> message. </p>
<h3 id="logging">Logging</h3>
<p>This message proxies communication from the interactive → LARA → Logging server. 
There is only one way communication between the interactive and LARA. The interactive is expected to post following messages using iframe phone:</p>
<pre><code class="javascript">phone.post('log', {action: 'actionName', data: {someValue: 1, otherValue: 2}});
</code></pre>

<p>LARA listens to these events only when logging is enabled (they will be ignored otherwise). 
When a <code>log</code> message is received, LARA issues a POST request to the Logging server. LARA uses provided action name and data, 
but also adds additional information to the event (context that might useful for researchers, e.g. user name, activity name, url, session ID, etc.).</p>
<h3 id="auth-info">Auth info</h3>
<p>Interactive can ask LARA about the current users authentication information using <code>getAuthInfo</code> message. It has no payload data:</p>
<pre><code class="javascript">phone.post('getAuthInfo');
</code></pre>

<p>LARA responds using <code>authInfo</code> message:</p>
<pre><code class="javascript">phone.addListener('authInfo', function (info) {
  // ...
});  
</code></pre>

<p>The payload is the object <code>{provider: &lt;string&gt;, loggedIn: &lt;boolean&gt;, email: &lt;string&gt;}</code> where <code>provider</code> and <code>loggedIn</code>
are always set and <code>email</code> is only set if the user has an email address.</p>
<h3 id="getextendedsupport">getExtendedSupport</h3>
<p>TODO</p>
<p>PJ: do we really want to document and support these messages / feature? </p>
<p>I know it's implemented, but it's a bit unclear to me, including naming (what is extendedSupport and why is it realted
to state resetting?).</p>
<h3 id="linked-interactives">Linked interactives</h3>
<p>TODO</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../shutterbug/" class="btn btn-neutral float-right" title="Shutterbug API">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href=".." class="btn btn-neutral" title="LARA Interactive API"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href=".." style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../shutterbug/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
