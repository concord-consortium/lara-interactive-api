<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>LARA Interactive API</title>
  

  <link rel="shortcut icon" href="./img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="./css/theme.css" type="text/css" />
  <link rel="stylesheet" href="./css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="./css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "None";
    var mkdocs_page_input_path = "index.md";
    var mkdocs_page_url = "/";
  </script>
  
  <script src="./js/jquery-2.1.1.min.js"></script>
  <script src="./js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="./js/highlight.pack.js"></script>
  <script src="./js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="." class="icon icon-home"> LARA Interactive API</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href=".">LARA Interactive API</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#lara-interactive-api">LARA Interactive API</a></li>
                
                    <li><a class="toctree-l4" href="#startup-and-initialization">Startup and Initialization</a></li>
                
                    <li><a class="toctree-l4" href="#iframe-savercoffee-messages">iframe-saver.coffee Messages</a></li>
                
                    <li><a class="toctree-l4" href="#global-iframe-savercoffee-messages">global-iframe-saver.coffee Messages</a></li>
                
                    <li><a class="toctree-l4" href="#loggerjs-messages">logger.js Messages</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="shutterbug/">Shutterbug API</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="using-iframe-phone/">Using iFramePhone</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="safari-cookies-redirects/">Safari / IE, cookies and iframe redirects</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="about-mkdocs/">About the documentation generator</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href=".">LARA Interactive API</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".">Docs</a> &raquo;</li>
    
      
    
    <li>LARA Interactive API</li>
    <li class="wy-breadcrumbs-aside">
      
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="lara-interactive-api">LARA Interactive API</h1>
<p>Table of contents:</p>
<div class="toc">
<ul>
<li><a href="#lara-interactive-api">LARA Interactive API</a><ul>
<li><a href="#startup-and-initialization">Startup and Initialization</a></li>
<li><a href="#iframe-savercoffee-messages">iframe-saver.coffee Messages</a><ul>
<li><a href="#getextendedsupport">getExtendedSupport</a></li>
<li><a href="#extendedsupport">extendedSupport</a></li>
<li><a href="#getlearnerurl">getLearnerUrl</a></li>
<li><a href="#setlearnerurl">setLearnerUrl</a></li>
<li><a href="#getinteractivestate">getInteractiveState</a></li>
<li><a href="#interactivestate">interactiveState</a></li>
<li><a href="#getauthinfo">getAuthInfo</a></li>
<li><a href="#authinfo">authInfo</a></li>
<li><a href="#loadinteractive">loadInteractive</a></li>
<li><a href="#initinteractive">initInteractive</a></li>
</ul>
</li>
<li><a href="#global-iframe-savercoffee-messages">global-iframe-saver.coffee Messages</a><ul>
<li><a href="#interactivestateglobal">interactiveStateGlobal</a></li>
<li><a href="#loadinteractiveglobal">loadInteractiveGlobal</a></li>
</ul>
</li>
<li><a href="#loggerjs-messages">logger.js Messages</a><ul>
<li><a href="#log">log</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h2 id="startup-and-initialization">Startup and Initialization</h2>
<p>LARA interactive iframes communicate by using <a href="https://github.com/concord-consortium/iframe-phone">iFramePhone</a> through three scripts loaded by the server in the browser:  <a href="https://github.com/concord-consortium/LARA/blob/master/app/assets/javascripts/iframe-saver.coffee">iframe-saver.coffee</a>,
<a href="https://github.com/concord-consortium/LARA/blob/master/app/assets/javascripts/global-iframe-saver.coffee">global-iframe-saver.coffee</a> and
<a href="https://github.com/concord-consortium/lara/blob/b51f764600816844088a0d45dc4493c0510eefe0/app/assets/javascripts/logger.js">logger.js</a>.  The LARA logging service also uses iFramePhones <a href="https://github.com/concord-consortium/iframe-phone/blob/master/lib/iframe-phone-rpc-endpoint.js">RPC endpoint</a> to log events from the interactives.</p>
<p>The iframe-saver.coffee script first listens for the iFramePhone to connect and registers the message handlers documented below, then sends separate <code>getExtendedSupport</code> and <code>getLearnerUrl</code>
requests to the client and finally calls back to the LARA server to get the current interactive state.  If there is existing interactive state the client will receive a <code>loadInteractive</code> message with the current interactive state as the parameter to the message.  However if no previous interactive state is found on the server the client will <strong>not</strong> receive a callback.  To allow interactives to have a
consistent startup a new message was added, <code>initInteractive</code> (documented below), which is always sent to the client after the server is queried for the interactive state by iframe-saver.coffee.</p>
<p>The global-iframe-saver.coffee script sets up a listener for the <code>interactiveStateGlobal</code> message and sends one message: <code>loadInteractiveGlobal</code>.</p>
<p>The logger.js sets up a listener for the <code>log</code> message.</p>
<p>Since the three scripts above and the interactive's code are both running in the browser we will use the term server to mean the code in scripts interfacing with LARA above and client to be the interactive.</p>
<h2 id="iframe-savercoffee-messages">iframe-saver.coffee Messages</h2>
<p>The client-side API can be split into two parts: messages initiated by the server to inform the client or request data back from the client and those initiated by the client to inform the server or request data back from the server.  Some of the messages from the client can be both responses to the server when it queries for information and requests to the server to set that information.</p>
<h3 id="getextendedsupport">getExtendedSupport</h3>
<p>Sent automatically by the server at startup to query the client about their <code>extendedSupport</code> status.  This is the first message the client will receive and is sent before the call is made to
the server to get the interactive state.  It has no payload data.</p>
<h3 id="extendedsupport">extendedSupport</h3>
<p>Can be thought of as <code>setExtendedSupport</code>. Sent by the client either in response to receiving a <code>getExtendedSupport</code> message or can be initiated by the client.  The payload for the message is an object with the following structure: <code>{reset: &lt;boolean&gt;}</code>.  If <code>reset</code> is true, we will allow the user to 'reset' the interactive via the <em>delete</em> button in the LARA runtime.</p>
<h3 id="getlearnerurl">getLearnerUrl</h3>
<p>Sent automatically by the server at startup to query the client about their learner url (the client responds via <code>setLearnerUrl</code>).  This is the second message the client will receive and is sent before the call is made to the server to get the interactive state.  It has no payload data.</p>
<h3 id="setlearnerurl">setLearnerUrl</h3>
<p>Sent by the client either in response to receiving a <code>getLearnerUrl</code> message or can be initiated by the client. The payload for the message is the string that denotes exact URL for the current student.</p>
<h3 id="getinteractivestate">getInteractiveState</h3>
<p>Sent automatically by the server every 5 seconds to query the client about their interactive state. It has no payload data.</p>
<h3 id="interactivestate">interactiveState</h3>
<p>Can be thought of as <code>setInteractiveState</code>. Sent by the client either in response to receiving a <code>getInteractiveState</code> message or can be initiated by the client.  The payload for the message is an arbitrary serializable object that will be stored by the LARA server.</p>
<h3 id="getauthinfo">getAuthInfo</h3>
<p>Sent by the client to the server to request the current users authentication information.  It has no payload data.</p>
<h3 id="authinfo">authInfo</h3>
<p>Sent by the server only in response to a <code>getAuthInfo</code> request by the client.  The payload is the object <code>{provider: &lt;string&gt;, loggedIn: &lt;boolean&gt;, email: &lt;string&gt;}</code> where <code>provider</code> and <code>loggedIn</code>
are always set and <code>email</code> is only set if the user has an email address.</p>
<h3 id="loadinteractive">loadInteractive</h3>
<p>Sent by the server at startup after the LARA server is queried about the interactive's state and <em>only</em> if the interactive has state.  The payload for the message is a arbitrary serialized object
previously set by the <code>interactiveState</code> message.</p>
<h3 id="initinteractive">initInteractive</h3>
<p>Sent by the server at startup after the LARA server is queried about the interactive's state.  This message will always be sent, even if there is an error querying the server about the interactive state.
The payload is the object:</p>
<p><code>{version: 1, error: &lt;string&gt;, interactiveState: &lt;object&gt;, hasLinkedState: &lt;boolean&gt;, linkedState: &lt;object&gt;}</code></p>
<p>The <code>error</code> member will be a string denoting any error querying the server about the interactive state or will be null otherwise.  The <code>interactiveState</code> member will be null if there is no current state or will otherwise be the same object returned by <code>loadInteractive</code>.  The <code>hasLinkedState</code> member will be true if the interactive is linked to another interactive in the authoring system and the <code>linkedState</code> will be the current interactive state of that linked interactive.  Linked interactives are currently in development.</p>
<h2 id="global-iframe-savercoffee-messages">global-iframe-saver.coffee Messages</h2>
<h4 id="interactivestateglobal">interactiveStateGlobal</h4>
<p>Sent by the client to the server and sets the global state that should be shared with all the interactives embedded in the current activity for the current student.  The payload for the message is
an arbitrary serializable object. The global state is saved in database as text (stringified JSON) and LARA does not care about its content.</p>
<p>Once this message is received, the server immediately posts <code>loadInteractiveGlobal</code> to all interactives on the same page (except from the sender of the original save message).</p>
<h4 id="loadinteractiveglobal">loadInteractiveGlobal</h4>
<p>Sent by the server to all interactives on the current page (for current activity and student).  The payload for the message is an arbitrary serialized object.  It's interactive responsibility to interpret this message and load (or not) the given state.</p>
<p>This message is sent by the server when:</p>
<ul>
<li>The <code>interactiveStateGlobal</code> message is received by the server</li>
<li>The activity page is loaded <strong>and</strong> the global interactive state is available in LARA activity run (so only if <code>interactiveStateGlobal</code> has been received earlier)</li>
</ul>
<h2 id="loggerjs-messages">logger.js Messages</h2>
<h3 id="log">log</h3>
<p>This message proxies communication from the interactive → LARA → Logging server.  There is only one way communication between the interactive and LARA. The interactive is expected to post following messages using iframe phone:</p>
<pre><code class="javascript">phone.post('log', {action: 'actionName', data: {someValue: 1, otherValue: 2})
</code></pre>

<p>LARA listens to these events only when logging is enabled (they will be ignored otherwise). When a <code>log</code> message is received, LARA issues a POST request to the Logging server. LARA uses provided action name and data, but also adds additional information to the event (context that might useful for researchers, e.g. user name, activity name, url, session ID, etc.).</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="shutterbug/" class="btn btn-neutral float-right" title="Shutterbug API">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
        <span style="margin-left: 15px"><a href="shutterbug/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>

<!--
MkDocs version : 0.15.3
Build Date UTC : 2016-07-07 17:55:30.039517
-->
