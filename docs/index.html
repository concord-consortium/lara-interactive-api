<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="None" /><link rel="canonical" href="http://concord-consortium.github.io/lara-interactive-api/" />
      <link rel="shortcut icon" href="img/favicon.ico" />
    <title>LARA Interactive API</title>
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "LARA Interactive API";
        var mkdocs_page_input_path = "index.md";
        var mkdocs_page_url = "/lara-interactive-api/";
      </script>
    
    <script src="js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="." class="icon icon-home"> LARA Interactive API
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="implementing-interactive/">Implementing Interactive</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href=".">LARA Interactive API</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#startup-and-initialization">Startup and Initialization</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#iframe-savercoffee-messages">iframe-saver.coffee Messages</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#getextendedsupport">getExtendedSupport</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#extendedsupport">extendedSupport</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#getlearnerurl">getLearnerUrl</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#setlearnerurl">setLearnerUrl</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#getinteractivestate">getInteractiveState</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#interactivestate">interactiveState</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#getauthinfo">getAuthInfo</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#authinfo">authInfo</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#loadinteractive">loadInteractive</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#initinteractive">initInteractive</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#navigation">navigation</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#global-iframe-savercoffee-messages">global-iframe-saver.coffee Messages</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#interactivestateglobal">interactiveStateGlobal</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#loadinteractiveglobal">loadInteractiveGlobal</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#loggerjs-messages">logger.js Messages</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#log">log</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="shutterbug/">Shutterbug API</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="using-iframe-phone/">Using iFramePhone</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="safari-cookies-redirects/">Safari / IE, cookies and iframe redirects</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="about-mkdocs/">About the documentation generator</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href=".">LARA Interactive API</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>LARA Interactive API</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/concord-consortium/lara-interactive-api/edit/master/docs/index.md" class="icon icon-github"> Edit on Github</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="lara-interactive-api">LARA Interactive API<a class="headerlink" href="#lara-interactive-api" title="Permanent link"></a></h1>
<p>Table of contents:</p>
<div class="toc">
<ul>
<li><a href="#lara-interactive-api">LARA Interactive API</a><ul>
<li><a href="#startup-and-initialization">Startup and Initialization</a></li>
<li><a href="#iframe-savercoffee-messages">iframe-saver.coffee Messages</a><ul>
<li><a href="#getextendedsupport">getExtendedSupport</a></li>
<li><a href="#extendedsupport">extendedSupport</a></li>
<li><a href="#getlearnerurl">getLearnerUrl</a></li>
<li><a href="#setlearnerurl">setLearnerUrl</a></li>
<li><a href="#getinteractivestate">getInteractiveState</a></li>
<li><a href="#interactivestate">interactiveState</a></li>
<li><a href="#getauthinfo">getAuthInfo</a></li>
<li><a href="#authinfo">authInfo</a></li>
<li><a href="#loadinteractive">loadInteractive</a></li>
<li><a href="#initinteractive">initInteractive</a></li>
<li><a href="#navigation">navigation</a></li>
</ul>
</li>
<li><a href="#global-iframe-savercoffee-messages">global-iframe-saver.coffee Messages</a><ul>
<li><a href="#interactivestateglobal">interactiveStateGlobal</a></li>
<li><a href="#loadinteractiveglobal">loadInteractiveGlobal</a></li>
</ul>
</li>
<li><a href="#loggerjs-messages">logger.js Messages</a><ul>
<li><a href="#log">log</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h2 id="startup-and-initialization">Startup and Initialization<a class="headerlink" href="#startup-and-initialization" title="Permanent link"></a></h2>
<p>LARA interactive iframes communicate by using <a href="https://github.com/concord-consortium/iframe-phone">iFramePhone</a> through three scripts loaded by the server in the browser:  <a href="https://github.com/concord-consortium/LARA/blob/master/app/assets/javascripts/iframe-saver.coffee">iframe-saver.coffee</a>,
<a href="https://github.com/concord-consortium/LARA/blob/master/app/assets/javascripts/global-iframe-saver.coffee">global-iframe-saver.coffee</a> and
<a href="https://github.com/concord-consortium/lara/blob/b51f764600816844088a0d45dc4493c0510eefe0/app/assets/javascripts/logger.js">logger.js</a>.  The LARA logging service also uses iFramePhones <a href="https://github.com/concord-consortium/iframe-phone/blob/master/lib/iframe-phone-rpc-endpoint.js">RPC endpoint</a> to log events from the interactives.</p>
<p>The iframe-saver.coffee script first listens for the iFramePhone to connect and registers the message handlers documented below, then sends separate <code>getExtendedSupport</code> and <code>getLearnerUrl</code>
requests to the client and finally calls back to the LARA server to get the current interactive state.  If there is existing interactive state the client will receive a <code>loadInteractive</code> message with the current interactive state as the parameter to the message.  However if no previous interactive state is found on the server the client will <strong>not</strong> receive a callback.  To allow interactives to have a
consistent startup a new message was added, <code>initInteractive</code> (documented below), which is always sent to the client after the server is queried for the interactive state by iframe-saver.coffee.</p>
<p>The global-iframe-saver.coffee script sets up a listener for the <code>interactiveStateGlobal</code> message and sends one message: <code>loadInteractiveGlobal</code>.</p>
<p>The logger.js sets up a listener for the <code>log</code> message.</p>
<p>Since the three scripts above and the interactive's code are both running in the browser we will use the term server to mean the code in scripts interfacing with LARA above and client to be the interactive.</p>
<h2 id="iframe-savercoffee-messages">iframe-saver.coffee Messages<a class="headerlink" href="#iframe-savercoffee-messages" title="Permanent link"></a></h2>
<p>The client-side API can be split into two parts: messages initiated by the server to inform the client or request data back from the client and those initiated by the client to inform the server or request data back from the server.  Some of the messages from the client can be both responses to the server when it queries for information and requests to the server to set that information.</p>
<h3 id="getextendedsupport">getExtendedSupport<a class="headerlink" href="#getextendedsupport" title="Permanent link"></a></h3>
<p>Sent automatically by the server at startup to query the client about their <code>extendedSupport</code> status.  This is the first message the client will receive and is sent before the call is made to
the server to get the interactive state.  It has no payload data.</p>
<h3 id="extendedsupport">extendedSupport<a class="headerlink" href="#extendedsupport" title="Permanent link"></a></h3>
<p>Can be thought of as <code>setExtendedSupport</code>. Sent by the client either in response to receiving a <code>getExtendedSupport</code> message or can be initiated by the client.  The payload for the message is an object with the following structure: <code>{reset: &lt;boolean&gt;}</code>.  If <code>reset</code> is true, we will allow the user to 'reset' the interactive via the <em>delete</em> button in the LARA runtime.</p>
<h3 id="getlearnerurl">getLearnerUrl<a class="headerlink" href="#getlearnerurl" title="Permanent link"></a></h3>
<p><strong>DEPRECATED</strong> instead you should use the messages that save and load interactive state: <code>initInteractive</code>, <code>getInteractiveState</code>, <code>interactiveState</code></p>
<p>Sent automatically by the server at startup to query the client about their learner url (the client responds via <code>setLearnerUrl</code>).  This is the second message the client will receive and is sent before the call is made to the server to get the interactive state.  It has no payload data.</p>
<h3 id="setlearnerurl">setLearnerUrl<a class="headerlink" href="#setlearnerurl" title="Permanent link"></a></h3>
<p><strong>DEPRECATED</strong> instead you should use the messages that save and load interactive state: <code>initInteractive</code>, <code>getInteractiveState</code>, <code>interactiveState</code></p>
<p>Sent by the client either in response to receiving a <code>getLearnerUrl</code> message or can be initiated by the client. The payload for the message is the string that denotes exact URL for the current student.</p>
<h3 id="getinteractivestate">getInteractiveState<a class="headerlink" href="#getinteractivestate" title="Permanent link"></a></h3>
<p>Sent automatically by the server every 5 seconds to query the client about their interactive state. It has no payload data.</p>
<p>This is also sent by LARA before changing pages.  The client must respond with <code>initInteractive</code>.</p>
<p><strong>IMPORTANT</strong> If the client does not respond with the <code>interactiveState</code> message then LARA will not change pages.</p>
<h3 id="interactivestate">interactiveState<a class="headerlink" href="#interactivestate" title="Permanent link"></a></h3>
<p>Can be thought of as <code>setInteractiveState</code>. Sent by the client either in response to receiving a <code>getInteractiveState</code> message or can be initiated by the client.  The payload for the message is an arbitrary serializable object that will be stored by the LARA server.</p>
<h3 id="getauthinfo">getAuthInfo<a class="headerlink" href="#getauthinfo" title="Permanent link"></a></h3>
<p>Sent by the client to the server to request the current users authentication information.  It has no payload data.</p>
<h3 id="authinfo">authInfo<a class="headerlink" href="#authinfo" title="Permanent link"></a></h3>
<p>Sent by the server only in response to a <code>getAuthInfo</code> request by the client.  The payload is the object <code>{provider: &lt;string&gt;, loggedIn: &lt;boolean&gt;, email: &lt;string&gt;}</code> where <code>provider</code> and <code>loggedIn</code>
are always set and <code>email</code> is only set if the user has an email address.</p>
<h3 id="loadinteractive">loadInteractive<a class="headerlink" href="#loadinteractive" title="Permanent link"></a></h3>
<p><strong>DEPRECATED</strong> The <code>initInteractive</code> message includes the state, and should be used to get the state instead.</p>
<p>Sent by the server at startup after the LARA server is queried about the interactive's state and <em>only</em> if the interactive has state.  The payload for the message is a arbitrary serialized object
previously set by the <code>interactiveState</code> message.</p>
<h3 id="initinteractive">initInteractive<a class="headerlink" href="#initinteractive" title="Permanent link"></a></h3>
<p>Sent by the server at startup after the LARA server is queried about the interactive's state.  This message will always be sent, even if there is an error querying the server about the interactive state.</p>
<p>See the <a href="implementing-interactive/#handling-the-initinteractive-message">initInteractive section in Implementing Interactive</a> for details.</p>
<h3 id="navigation">navigation<a class="headerlink" href="#navigation" title="Permanent link"></a></h3>
<p>Sent by the client to enable/disable page navigation.  The payload is the object <code>{enableForwardNav: &lt;boolean&gt;, message: string}</code> where <code>message</code> is an optional message shown in an jQuery alert box when the forward navigation is clicked when disabled.</p>
<h2 id="global-iframe-savercoffee-messages">global-iframe-saver.coffee Messages<a class="headerlink" href="#global-iframe-savercoffee-messages" title="Permanent link"></a></h2>
<h4 id="interactivestateglobal">interactiveStateGlobal<a class="headerlink" href="#interactivestateglobal" title="Permanent link"></a></h4>
<p>Sent by the client to the server and sets the global state that should be shared with all the interactives embedded in the current activity for the current student.  The payload for the message is
an arbitrary serializable object. The global state is saved in database as text (stringified JSON) and LARA does not care about its content.</p>
<p>Once this message is received, the server immediately posts <code>loadInteractiveGlobal</code> to all interactives on the same page (except from the sender of the original save message).</p>
<h4 id="loadinteractiveglobal">loadInteractiveGlobal<a class="headerlink" href="#loadinteractiveglobal" title="Permanent link"></a></h4>
<p>Sent by the server to all interactives on the current page (for current activity and student).  The payload for the message is an arbitrary serialized object.  It's interactive responsibility to interpret this message and load (or not) the given state.</p>
<p>This message is sent by the server when:</p>
<ul>
<li>The <code>interactiveStateGlobal</code> message is received by the server</li>
<li>The activity page is loaded <strong>and</strong> the global interactive state is available in LARA activity run (so only if <code>interactiveStateGlobal</code> has been received earlier)</li>
</ul>
<h2 id="loggerjs-messages">logger.js Messages<a class="headerlink" href="#loggerjs-messages" title="Permanent link"></a></h2>
<h3 id="log">log<a class="headerlink" href="#log" title="Permanent link"></a></h3>
<p>This message proxies communication from the interactive → LARA → Logging server.  There is only one way communication between the interactive and LARA. The interactive is expected to post following messages using iframe phone:</p>
<pre><code class="language-javascript">phone.post('log', {action: 'actionName', data: {someValue: 1, otherValue: 2})
</code></pre>
<p>LARA listens to these events only when logging is enabled (they will be ignored otherwise). When a <code>log</code> message is received, LARA issues a POST request to the Logging server. LARA uses provided action name and data, but also adds additional information to the event (context that might useful for researchers, e.g. user name, activity name, url, session ID, etc.).</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="implementing-interactive/" class="btn btn-neutral float-left" title="Implementing Interactive"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="shutterbug/" class="btn btn-neutral float-right" title="Shutterbug API">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="implementing-interactive/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="shutterbug/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '.';</script>
    <script src="js/theme_extra.js" defer></script>
    <script src="js/theme.js" defer></script>
      <script src="search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>

<!--
MkDocs version : 1.4.1
Build Date UTC : 2022-10-25 13:27:17.308594+00:00
-->
